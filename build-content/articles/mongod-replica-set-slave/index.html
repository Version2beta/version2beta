<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>A quick note on MongoDB replica sets &#124; version2beta</title><meta name="description" content="Once again, I didn't find an answer online, so I'm putting it out here."><meta name="keywords" content=""><meta name="viewport" content="width=device-width, initial-scale=1"><link href="/archive/atom.xml" rel="alternate" title="version2beta" type="application/atom+xml"><link rel="stylesheet" href="/style/layout.css" type="text/css" media="screen"><link rel="stylesheet" href="/style/text-styling.css" type="text/css" media="screen"><link rel="stylesheet" href="/style/responsive.css" type="text/css" media="screen"><link rel="shortcut icon" href="/static/site/favicon.png"></head><body><div id="site"><div id="menu"><div id="sitename"><a href="/">version2beta</a></div><nav id="top-nav"><div id="menu-toggle"><a href="#top-nav" class="open-menu"><img src="/static/site/menu-toggle.png" alt="+"></a><a href="#" class="close-menu"><img src="/static/site/menu-toggle-close.png" alt="—"></a></div><ul id="sitenav"><li><a href="/about">about</a></li><li><a href="/speaking">speak</a></li><li><a href="/hire">hire</a></li><li><a href="/">blog</a></li></ul></nav></div><div class="content"><article id="main-content"><div id="content-header"><h1>A quick note on MongoDB replica sets</h1><p><span class="author">by <a href="https://plus.google.com/115037548656448421726?rel=author">Rob Martin</a>  on </span><span class="post-date"><time pubdate>2011-11-29 at 11:49</time></span><span class="post-tag"><span></span></span></p><p class="readable"><a href="/readable/articles/mongod-replica-set-slave">Highly readable version</a></p></div><div id="post-content"><p>MongoDB is replying to a replica-set add command with &quot;Need most members up to reconfigure, not ok&quot;. The problem is with my configuration.</p>
<p>Here's the error:</p>
<pre><code>PRIMARY&gt; rs.add(&quot;nosql1-private:27017&quot;)
{
    &quot;assertion&quot; : &quot;need most members up to reconfigure, not ok : nosql1-private:27017&quot;,
    &quot;assertionCode&quot; : 13144,
    &quot;errmsg&quot; : &quot;db assertion failure&quot;,
    &quot;ok&quot; : 0
}
</code></pre>
<p>The problem is in my configuration on the slave Mongod. Note that I'm using a configuration file, rather than command line options, which is how the tutorials are written. This fits in with my init file, which I can share if anyone wants an Ubuntu init for MongoDB 2.0.2.</p>
<pre><code>fork = true
bind_ip = nosql1-private
port = 27017 # default port
logpath = /var/log/mongodb/mongod.log
logappend = true
cpu = true # log CPU activity periodically
journal = true
auth = true
replSet = gedc
</code></pre>
<p>I disabled journal (shouldn't be needed on a slave, right?) and auth, which seems to actually be the problem. After, the rs.add() works fine.</p>
<pre><code>PRIMARY&gt; rs.add(&quot;nosql1-private:27017&quot;)
{ &quot;ok&quot; : 1 }
</code></pre>
<p>I'm not sure I don't have to go back and get auth reenabled, though, because now my status says that the second server is &quot;still initializing&quot; and &quot;(not reachable/healthy)&quot;. But when I try to add authentication credentials, I get this error:</p>
<pre><code>uncaught exception: error { &quot;$err&quot; : &quot;not master and slaveok=false&quot;, &quot;code&quot; : 13435 }
</code></pre>
<p>So, I did discover what I really needed was a keyFile directive<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> in my mongod.conf. The file itself contains a base64 text key the servers will use for communicating.</p>
<pre><code>...
keyFile = /etc/mongodb/key.txt
...
</code></pre>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1"  class="footnote-item"><p>See the &quot;Replica Set and Sharding Authentication&quot; section on the <a href="http://www.mongodb.org/display/DOCS/Security+and+Authentication#SecurityandAuthentication-ReplicaSetandShardingAuthentication" title="MongoDB docs for security and authentication, including key files for shards and replica sets.">MongoDB doc page for Security and Authentication</a>. <a href="#fnref1" class="footnote-backref">↩</a></p>
</li>
</ol>
</section>
<h3>Talk back to me</h3><p>You can comment below. Or <a href="http://www.twitter.com/#!/version2beta" title="version2beta on twitter">tweet at me</a>. I'm always open to a good conversation.</p><div id="disqus_thread"></div><script type="text/javascript">var disqus_shortname = 'version2beta';
var disqus_identifier = '/articles/mongod-replica-set-slave';
var disqus_url = 'http://version2beta.com/articles/mongod-replica-set-slave';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></article></div></div></body><footer><div id="footer"><p class="contact"><a href="https://plus.google.com/115037548656448421726?rel=author">Rob Martin</a>: <a href="mailto:rob@version2beta.com">rob@version2beta.com</a></p><p class="creative-commons">This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.</p><p id="social"><a href="/rss.xml" title="A news feed for my blog"><img src="/static/site/rss-icon.png" alt="RSS feed icon"></a><a href="http://twitter.com/version2beta" title="Find me on Twitter"><img src="/static/site/twitter-icon.png" alt="Twitter icon"></a></p></div></footer><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-12023701-1']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script><script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script><script src="/static/js/css3-mediaqueries.js"></script></html>